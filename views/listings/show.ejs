<% layout("/layouts/boilerplate.ejs")%>
<body>
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card border rounded-3 mb-4">
          <!-- removed 'shadow' class -->
          <img
            src="<%= result.image.url %>"
            class="card-img-top rounded-top"
            alt="Listing image"
          />

          <div class="card-body">
            <h4 class="card-title mb-3 fw-bold"><%= result.title %></h4>
            <p class="card-text"><%= result.description %></p>
            <ul class="list-unstyled">
              <li>
                <strong>Price:</strong> â‚¹ <%=
                result.price.toLocaleString("en-IN") %>
              </li>
              <li><strong>Location:</strong> <%= result.location %></li>
              <li><strong>Country:</strong> <%= result.country %></li>
            </ul>
          </div>

          <div
            class="card-footer bg-white d-flex justify-content-between border-top"
          >
            <a
              href="/listings/<%= result.id %>/edit"
              class="btn btn-outline-dark"
            >
              Edit
            </a>
            <form
              method="POST"
              action="/listings/<%= result.id %>?_method=DELETE"
            >
              <button type="submit" class="btn btn-outline-danger">
                Delete
              </button>
            </form>
          </div>

          <!-- You had an extra 'col-8 offset-3' inside card. Placed it correctly -->
          <div class="p-4 border-top">
            <h5 class="mb-3">Leave a Review</h5>
            <form
              action="/listings/<%=result.id%>/review"
              method="POST"
              novalidate
              class="needs-validation"
            >
              <div class="mb-3">
                <label for="rating" class="form-label">Rating</label>
                <input
                  type="range"
                  class="form-range"
                  min="1"
                  max="5"
                  id="rating"
                  name="review[rating]"
                />
              </div>
              <div class="mb-3">
                <label for="comment" class="form-label">Comments</label>
                <textarea
                  class="form-control"
                  name="review[comment]"
                  id="comment"
                  rows="5"
                  placeholder="Write your thoughts here..."
                  required
                  class="form-control"
                ></textarea>
                <div class="invalid-feedback">Please fill the review</div>
              </div>
              <div class="text-end">
                <button type="submit" class="btn btn-primary">
                  Submit Review
                </button>
              </div>
            </form>
          </div>

          <!--reviews section-->
          <section>
            <div class="p-4 border-top">
              <h4 class="mb-4">Reviews</h4>

              <% if (result.reviews.length === 0) { %>
              <p class="text-muted">
                No reviews yet. Be the first to leave one!
              </p>
              <% } else { %> <% result.reviews.forEach((x) => { %>
              <div class="card mb-3 shadow-sm">
                <div class="card-body">
                  <div
                    class="d-flex justify-content-between align-items-center mb-2"
                  >
                    <h6 class="mb-0">Anonymous User</h6>
                    <div>
                      <% for (let i = 1; i <= 5; i++) { %> <% if (i <= x.rating)
                      { %>
                      <i class="bi bi-star-fill text-warning"></i>
                      <% } else { %>
                      <i class="bi bi-star text-warning"></i>
                      <% } %> <% } %>
                    </div>
                  </div>
                  <p class="mb-0 text-secondary"><%= x.comment %></p>
                </div>
                <form
                  action="/listings/<%= result.id %>/review/<%= x._id %>?_method=DELETE"
                  method="POST"
                  class="text-end mt-2"
                >
                  <button type="submit" class="btn btn-sm btn-outline-danger">
                    Delete
                  </button>
                </form>
              </div>
              <% }) %> <% } %>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>
</body>
